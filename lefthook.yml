pre-push:
  parallel: true
  commands:
    check-staged-files:
      run: |
        if git diff --cached --exit-code > /dev/null; then
          echo "✅ No staged files found. Push is allowed."
        else
          echo "❌ Error: There are staged files that haven't been committed."
          echo "This usually happens when pre-commit hooks format files but the changes aren't committed."
          echo ""
          echo "Staged files:"
          git diff --cached --name-only
          echo ""
          echo "Please commit these changes before pushing:"
          echo "  git add ."
          echo "  git commit --amend --no-edit"
          echo "  # or create a new commit"
          exit 1
        fi

pre-commit:
  parallel: true
  commands:
    lint:
      glob: "**/*.{js,mjs,ts,mts,jsx,tsx,json}"
      run: pnpm biome check --no-errors-on-unmatched --files-ignore-unknown=true --write {staged_files}
    lint-graphql:
      glob: "apps/extension/src/**/*.{js,mjs,ts,mts,jsx,tsx}"
      run: |
        if [ ! -d "apps/extension/node_modules" ]; then
          echo "⚠️  node_modules not found. Run 'pnpm install' first."
          exit 1
        fi
        echo "{staged_files}" | sed 's|apps/extension/||g' | xargs pnpm --filter @curio/extension lint --fix
    storybook-coverage:
      glob: "apps/{mobile,extension}/src/features/**/index.tsx"
      run: |
        echo "{staged_files}" | sed 's|/index\.tsx||g' | xargs node scripts/check-storybook-coverage.mjs
